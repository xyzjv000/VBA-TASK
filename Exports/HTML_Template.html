<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart Report</title>
    <link rel="stylesheet" type="text/css" href="{{cssFilePath}}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="mySidebar" class="sidebar">
      <div id="filter0">
        <div>
          <p style="text-align: center; font-weight: bold; margin: 0 0 5px">
            Extra Data
          </p>
          <div class="toggle-container">
            <input type="radio" id="dataHide" name="period" />
            <label for="dataHide">HIDE</label>

            <input type="radio" id="dataShow" name="period" />
            <label for="dataShow">SHOW</label>
          </div>
        </div>
        <div>
          <div class="searchNmi-container">
            <input
              type="search"
              id="searchNmi"
              name="searchNmi"
              placeholder="Search NMI"
            />
          </div>
        </div>
      </div>
      <div id="filter1">
        <p>
          Historical Performance FY2024, FY2025 Actuals vs POE and FY2026 vs POE
        </p>
        <div class="filter-container">
          <label for="filter1-portfolio">Portfolio</label>
          <select name="filter1-portfolio" id="filter1-portfolio"></select>
        </div>
        <div class="filter-container">
          <label for="filter1-status">Status</label>
          <select name="filter1-status" id="filter1-status"></select>
        </div>
        <div class="filter-container">
          <label for="filter1-association">Association</label>
          <select name="filter1-association" id="filter1-association"></select>
        </div>
        <div class="filter-container">
          <label for="filter1-agreement">Agreement</label>
          <select name="filter1-agreement" id="filter1-agreement"></select>
        </div>
        <div class="filter-container" style="display: none">
          <label for="filter1-nmi">NMI</label>
          <select name="filter1-nmi" id="filter1-nmi"></select>
        </div>
      </div>
      <div id="filter2">
        <p>Actual Cost and % , FY Actual Margin Vs POE</p>
        <div class="filter-container">
          <label for="filter2-year">Year</label>
          <select name="filter2-year" id="filter2-year"></select>
        </div>
        <div class="filter-container">
          <label for="filter2-margin">Types of Margin</label>
          <select name="filter2-margin" id="filter2-margin"></select>
        </div>
      </div>
      <div id="filter3">
        <p>Retail Margin per NMI</p>
        <div class="filter-container" style="display: none">
          <label for="filter3-nmi">NMI</label>
          <select name="filter3-nmi" id="filter3-nmi"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-fy">Financial Year</label>
          <select name="filter3-fy" id="filter3-fy"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-type">Type</label>
          <select name="filter3-type" id="filter3-type"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-portfolio">Portfolio</label>
          <select name="filter3-portfolio" id="filter3-portfolio"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-status">Status</label>
          <select name="filter3-status" id="filter3-status"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-agreement">Agreement</label>
          <select name="filter3-agreement" id="filter3-agreement"></select>
        </div>
        <div class="filter-container">
          <label for="filter3-association">Association</label>
          <select name="filter3-association" id="filter3-association"></select>
        </div>
        <div class="filter-container">
          <div id="clearChartFilter">
            <button>Select All Legends</button>
          </div>
        </div>
      </div>
      <div id="clearFilters">
        <button>Clear Filters</button>
      </div>
      <div id="exportButton">
        <button>Export PDF</button>
      </div>
      <div id="exportDataButton">
        <button>Export CSV</button>
      </div>
    </div>
    <div class="content">
      <div class="container">
        <div class="chart">
          <section id="page1">
            <div class="chart-container">
              <div class="chart-item">
                <center><h3>Historical Performance FY2024 Actuals</h3></center>
                <div id="hpfy24a"></div>
              </div>
              <div class="chart-item">
                <center><h3>Percentage Fees in FY2024</h3></center>
                <div id="pfify24"></div>
              </div>
            </div>

            <div class="table-container">
              <table id="table1">
                <thead>
                  <tr id="headerRow"></tr>
                </thead>
                <tbody>
                  <tr id="dataRow"></tr>
                </tbody>
              </table>
            </div>

            <!-- FY25 Actual vs POE -->
            <div>
              <div class="chart-item">
                <center><h3>FY25 Actual vs POE</h3></center>
                <div id="fy25avspoe"></div>
              </div>
            </div>
            <div class="table-container">
              <table id="table2">
                <thead>
                  <tr id="headerRow"></tr>
                </thead>
                <tbody>
                  <tr id="dataRow"></tr>
                </tbody>
              </table>
            </div>

            <!-- FY26 Actual vs POE -->
            <div>
              <div class="chart-item">
                <center><h3>FY26 Actual vs POE</h3></center>
                <div id="fy26avspoe"></div>
              </div>
            </div>
            <div class="table-container">
              <table id="table3">
                <thead>
                  <tr id="headerRow"></tr>
                </thead>
                <tbody>
                  <tr id="dataRow"></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- Actual Cost and Percentage -->

          <section id="page2">
            <div>
              <div class="chart-item">
                <center><h3>Actual Cost and Percentage</h3></center>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem">
                  <div id="acap"></div>
                  <div style="flex: 1" class="table-container">
                    <table id="table5">
                      <thead>
                        <tr id="headerRow"></tr>
                      </thead>
                      <tbody>
                        <tr id="dataRow"></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <div class="chart-item">
                <center><h3>Financial Year Actual Margin vs POE</h3></center>
                <div id="fyamvspoe"></div>
              </div>
            </div>
            <div class="table-container">
              <table id="table4">
                <thead>
                  <tr id="headerRow"></tr>
                </thead>
                <tbody>
                  <tr id="dataRow"></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- Retail Margin per NMI Base -->
          <section id="page3">
            <div>
              <div class="chart-item">
                <div class="header-table">
                  <div class="header-items">
                    <div class="header-item-label">Achieved Margin FY2024</div>
                    <div class="header-item-value" id="headerAchievedFy2024">
                      $0
                    </div>
                  </div>

                  <div class="header-items">
                    <div class="header-item-label">
                      Margin Aggregate to Current month
                    </div>
                    <div class="header-item-value" id="headerCurrentMonth">
                      $0
                    </div>
                  </div>

                  <div class="header-items">
                    <div class="header-item-label">Margin Forecast POE90%</div>
                    <div class="header-item-value" id="headerForecast90">
                      $0
                    </div>
                  </div>

                  <div class="header-items">
                    <div class="header-item-label">Margin Forecast 50%</div>
                    <div class="header-item-value" id="headerForecast50">
                      $0
                    </div>
                  </div>

                  <div class="header-items">
                    <div class="header-item-label">Margin forecast 10%</div>
                    <div class="header-item-value" id="headerForecast10">
                      $0
                    </div>
                  </div>

                  <div class="header-items">
                    <div class="header-item-label">
                      Margin Forecast Predicted TM
                    </div>
                    <div class="header-item-value" id="headerForecastTM">
                      $0
                    </div>
                  </div>
                </div>
              </div>
              <div class="chart-item">
                <center><h3>Retail Margin per NMI Base</h3></center>
                <h4 id="loading">Loading please wait...</h4>
                <div id="rmpnmibase"></div>
              </div>
            </div>
          </section>
        </div>
      </div>
      <div class="footer">
        <div class="footer-container">
          <!-- Footer items will be injected here -->
        </div>
      </div>
    </div>
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/maps.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script>
      let versionData = {{versionData}};
      let nmiJsonData = {{nmiJson}}
      let _combinedDataJsonFull = {{combinedFullJson}}
      let combinedDataJsonFull = []
      let extraData = JSON.parse(localStorage.getItem("extraData")) || false;
      const dataHide = document.getElementById("dataHide");
      const dataShow = document.getElementById("dataShow");

      function removeNotImportantData(dataArray) {
          return dataArray.map(item => {
              item.data = item.data.map(dataEntry => {
                  dataEntry.type = dataEntry.type.filter(typeEntry =>
                      !["securityDepositInterest", "securityDeposit", "roc"].includes(typeEntry.name)
                  );
                  return dataEntry;
              });
              return item;
          });
      }

      if(extraData) {
        console.log(extraData);
        combinedDataJsonFull = _combinedDataJsonFull
        dataShow.checked = true;
      }
      else {
        console.log(extraData);
        combinedDataJsonFull = removeNotImportantData(_combinedDataJsonFull);
        dataHide.checked = true;
      }
      console.log("versionData",versionData);
      console.log("nmiJsonData",nmiJsonData);
      console.log("combinedDataJsonFull",combinedDataJsonFull);
    </script>
    <!-- external -->
    <script src="{{jsFilePath}}"></script>
  </body>
</html>
